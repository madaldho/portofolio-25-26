---

import { journeyMilestones } from '../data/journey';
import { getProfile, isContentfulConfigured } from '../utils/contentful';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const locale = lang === 'id' ? 'id-ID' : 'en-US';

let profileData = {
  name: 'Muhamad Ali Ridho',
  role: 'Tech Enthusiast',
  avatar: '/profile-photo.jpg',
  bio: `Passionate tech enthusiast with a deep interest in artificial intelligence, Internet of Things (IoT), and web development.`,
  location: 'Jakarta, Indonesia',
  resume: '/resume.pdf'
};

try {
  if (isContentfulConfigured()) {
    const contentfulProfile = await getProfile(false, locale);
    if (contentfulProfile) {
      profileData = {
        name: contentfulProfile.fields.name,
        role: contentfulProfile.fields.title,
        avatar: contentfulProfile.fields.avatar?.fields?.file?.url 
          ? `https:${contentfulProfile.fields.avatar.fields.file.url}`
          : '/profile-photo.jpg',
        bio: contentfulProfile.fields.bio || profileData.bio,
        location: contentfulProfile.fields.location || profileData.location,
        resume: contentfulProfile.fields.resume?.fields?.file?.url 
          ? `https:${contentfulProfile.fields.resume.fields.file.url}`
          : profileData.resume
      };
    }
  }
} catch (error) {
  console.warn('Error fetching profile in About:', error);
}

const techStackIcons = [
  { name: 'HTML5', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg' },
  { name: 'CSS3', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/css3/css3-original.svg' },
  { name: 'JavaScript', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg' },
  { name: 'React', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/react/react-original.svg' },
  { name: 'Astro', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/astro/astro-original.svg' },
  { name: 'Tailwind CSS', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/tailwindcss/tailwindcss-original.svg' },
  { name: 'Figma', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/figma/figma-original.svg' },
  { name: 'Git', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/git/git-original.svg' },
  { name: 'GitHub', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg' },
  { name: 'Node.js', url: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nodejs/nodejs-original.svg' },
];
---

<section id="about" class="py-24 relative overflow-hidden bg-dark-bg">
  <!-- Subtle Background Decorations -->
  <div class="absolute top-0 right-0 w-1/2 h-1/2 bg-primary/5 rounded-full blur-[100px] pointer-events-none"></div>
  <div class="absolute bottom-0 left-0 w-1/2 h-1/2 bg-secondary/5 rounded-full blur-[100px] pointer-events-none"></div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-16 md:mb-24">
      <p class="text-primary font-mono text-sm tracking-wide mb-4 flex items-center justify-center gap-2">
        <span class="w-8 h-px bg-primary/50"></span>
        {t('about.title')}
        <span class="w-8 h-px bg-primary/50"></span>
      </p>
      <h2 class="text-display text-4xl md:text-5xl lg:text-6xl font-bold">
        {t('about.subtitle')}
      </h2>
    </div>

    <div class="grid lg:grid-cols-12 gap-12 lg:gap-20 items-center">
      <!-- LEFTSIDE: Photo -->
      <div class="lg:col-span-5">
        <div class="relative group max-w-sm mx-auto lg:max-w-none">
          <!-- Artistic border/background -->
          <div class="absolute -inset-4 rounded-[2.5rem] bg-linear-to-tr from-primary/20 via-transparent to-secondary/20 blur-2xl opacity-60 group-hover:opacity-80 transition-opacity duration-500"></div>
          
          <!-- Image Container -->
          <div class="relative aspect-4/5 rounded-2xl overflow-hidden border border-white/10 bg-dark-surface shadow-2xl">
            <!-- Overlay gradient -->
            <div class="absolute inset-0 bg-linear-to-t from-dark-bg/80 via-transparent to-transparent opacity-60 z-10"></div>
            
            <img
              src={profileData.avatar}
              alt={profileData.name}
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
              loading="lazy"
            />

            <!-- Floating Badge (Location) -->
            <div class="absolute bottom-6 left-6 right-6 z-20">
               <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 backdrop-blur-md border border-white/10 text-sm text-white/90 shadow-lg">
                  <svg class="w-4 h-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  <span>{profileData.location}</span>
               </div>
            </div>
          </div>
        </div>

        <!-- Download CV Button Mobile -->
        <div class="mt-8 text-center lg:hidden">
          <a
            href={profileData.resume}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-8 py-3 rounded-full bg-primary text-white font-medium hover:bg-primary/90 transition-all shadow-lg hover:shadow-primary/25"
          >
            <span>{t('about.downloadResume')}</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
          </a>
        </div>
      </div>

      <!-- RIGHTSIDE: Bio & Content -->
      <div class="lg:col-span-7 space-y-8">
        <!-- Bio -->
        <div class="space-y-6">
          <div>
            <h3 class="text-3xl lg:text-4xl font-bold text-white mb-2">{profileData.name}</h3>
            <p class="text-xl text-primary font-medium tracking-wide font-mono">{profileData.role}</p>
          </div>
          
          <div class="prose prose-invert prose-lg max-w-none">
             <p class="text-muted leading-relaxed text-lg">
                {t('about.description')}
             </p>
          </div>
          <div class="hidden lg:flex flex-wrap gap-4 pt-4">
             <a href="#contact" class="btn-outline-custom px-8 py-3 bg-white/5 hover:bg-white/10 text-white rounded-full transition-colors border border-white/10 hover:border-white/20 font-medium text-sm flex items-center gap-2 group">
                {t('contact.title')}
                <svg class="w-4 h-4 text-primary group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
             </a>
             <a href={profileData.resume} target="_blank" class="px-8 py-3 bg-primary hover:bg-primary-light text-white rounded-full transition-colors font-medium text-sm flex items-center gap-2 shadow-lg hover:shadow-primary/25">
                {t('about.downloadResume')}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
             </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Modern Infinite Tech Stack Slider (Logos Only) -->
    <div class="mt-24 mb-24 relative">
         <div class="text-center mb-12">
            <h4 class="text-2xl font-semibold text-white mb-3" data-i18n="about.skills">{t('about.skills')}</h4>
            <div class="w-12 h-1 bg-primary mx-auto rounded-full"></div>
            <p class="text-muted mt-4 max-w-2xl mx-auto" data-i18n="about.skillsDesc">
               {t('about.skillsDesc')}
            </p>
         </div>

         <!-- Marquee Container -->
         <div class="relative w-full overflow-hidden py-8 group bg-dark-surface/30 border-y border-white/5 backdrop-blur-sm marquee-wrapper">
             <!-- Fade Gradients -->
             <div class="absolute inset-y-0 left-0 w-24 fade-left z-10 pointer-events-none"></div>
             <div class="absolute inset-y-0 right-0 w-24 fade-right z-10 pointer-events-none"></div>

             <!-- Scrolling Content -->
             <div class="flex gap-8 animate-marquee hover:pause whitespace-nowrap w-max items-center px-4">
                 {[...techStackIcons, ...techStackIcons, ...techStackIcons, ...techStackIcons].map((tech) => (
                      <div class="group/icon flex flex-col items-center gap-3 select-none px-4 transition-transform hover:scale-110 duration-300 cursor-pointer">
                         <div class="w-16 h-16 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-center p-3 group-hover/icon:bg-white/10 group-hover/icon:border-primary/50 transition-all shadow-lg group-hover/icon:shadow-primary/20 icon-box">
                            <img 
                               src={tech.url} 
                               alt={tech.name}
                               class="w-full h-full object-contain opacity-50 group-hover/icon:opacity-100 transition-opacity grayscale group-hover/icon:grayscale-0"
                               loading="lazy"
                            />
                         </div>
                         <!-- Removed hardcoded text color, letting CSS handle it or using a more robust class -->
                         <span class="text-sm font-medium text-white/70 group-hover/icon:text-primary transition-colors icon-text">{tech.name}</span>
                      </div>
                  ))}
             </div>
         </div>
    </div>

    <!-- Centered Journey Section -->
    <div class="max-w-4xl mx-auto">
         <div class="text-center mb-12">
           <h4 class="text-2xl font-semibold text-white mb-2" data-i18n="about.journey">{t('about.journey')}</h4>
           <div class="w-12 h-1 bg-primary mx-auto rounded-full"></div>
         </div>

         <div class="relative border-l border-white/10 ml-3 md:ml-0 md:pl-0 space-y-8 md:space-y-12 py-2 timeline-container">
            <!-- Vertical Line Desktop -->
            <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-white/10 transform -translate-x-1/2 timeline-line"></div>
            
            {journeyMilestones.map((milestone, index) => {
              const localizedTitle = t(`journey.${milestone.year}.title` as any) || milestone.title;
              const localizedDesc = t(`journey.${milestone.year}.desc` as any) || milestone.description;

              return (
              <div class={`relative pl-8 md:pl-0 group md:flex md:items-center md:justify-between ${index % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
                 
                 <!-- Timeline Dot (Mobile) -->
                 <div class={`md:hidden absolute left-[-5px] top-1.5 w-2.5 h-2.5 rounded-full border border-dark-bg transition-colors duration-300 timeline-dot-mobile ${milestone.highlight ? 'bg-primary shadow-[0_0_10px_rgba(var(--color-primary),0.5)]' : 'bg-white/20 group-hover:bg-primary'}`}></div>
                 
                 <!-- Timeline Dot (Desktop) centered -->
                 <div class={`hidden md:block absolute left-1/2 top-1/2 -translate-y-1/2 -translate-x-1/2 w-4 h-4 rounded-full border-2 border-dark-bg z-10 transition-colors duration-300 timeline-dot-desktop ${milestone.highlight ? 'bg-primary shadow-[0_0_15px_rgba(var(--color-primary),0.6)] box-content' : 'bg-dark-surface border-white/20 group-hover:border-primary'}`}></div>

                 <!-- Empty Space -->
                 <div class="hidden md:block md:w-5/12"></div>

                 <!-- Card Content -->
                 <div class="md:w-5/12">
                   <div class={`p-5 rounded-xl border border-white/5 bg-white/2 hover:bg-white/5 transition-colors group-hover:border-white/10 journey-card ${milestone.highlight ? 'highlight border-primary/30 bg-primary/5' : ''}`}>
                      <div class="flex items-center justify-between mb-2">
                         <span class={`font-mono text-sm ${milestone.highlight ? 'text-primary font-bold' : 'text-white/80 milestone-year'}`}>
                            {milestone.year}
                         </span>
                         {milestone.highlight && (
                            <span class="w-1.5 h-1.5 rounded-full bg-primary animate-pulse"></span>
                         )}
                      </div>
                      <h5 class="text-lg font-semibold text-white mb-2 journey-title">
                         {localizedTitle}
                      </h5>
                      <p class="text-muted text-sm leading-relaxed journey-desc">
                         {localizedDesc}
                      </p>
                   </div>
                 </div>

              </div>
            );
            })}
         </div>
    </div>
  </div>
</section>

<style>
  /* --- Light Mode Adaptations --- */
  
  /* Fade Gradients in Marquee */
  .fade-left {
    background: linear-gradient(to right, var(--color-dark-bg), transparent);
  }
  .fade-right {
    background: linear-gradient(to left, var(--color-dark-bg), transparent);
  }

  :global(body.light) .fade-left {
    background: linear-gradient(to right, var(--color-light-bg), transparent);
  }
  :global(body.light) .fade-right {
    background: linear-gradient(to left, var(--color-light-bg), transparent);
  }
  
  :global(body.light) .marquee-wrapper {
    background-color: rgba(0,0,0,0.03); /* Subtle dark tint on light bg */
    border-color: rgba(0,0,0,0.05);
  }

  /* Icons */
  :global(body.light) .icon-box {
    background-color: rgba(0,0,0,0.05); /* Darker on light mode */
    border-color: rgba(0,0,0,0.1);
  }
  :global(body.light) .icon-box:hover {
    background-color: rgba(255,255,255,1);
    border-color: var(--color-primary);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }
  :global(body.light) .icon-text {
    color: rgba(0,0,0,0.5); /* Readable text */
  }
  :global(body.light) .group:hover .icon-text {
    color: var(--color-primary);
  }

  /* Timeline */
  :global(body.light) .timeline-container {
    border-left-color: rgba(0,0,0,0.1); 
  }
  
  :global(body.light) .timeline-line {
    background-color: rgba(0,0,0,0.1);
  }

  /* Timeline Dots */
  :global(body.light) .timeline-dot-mobile {
     border-color: var(--color-light-bg);
  }
  :global(body.light) .timeline-dot-mobile:not(.bg-primary) {
     background-color: rgba(0,0,0,0.2);
  }
  
  :global(body.light) .timeline-dot-desktop {
    border-color: var(--color-light-bg);
  }
  :global(body.light) .timeline-dot-desktop:not(.bg-primary) {
     background-color: var(--color-light-surface);
     border-color: rgba(0,0,0,0.2);
  }

  /* Journey Cards */
  :global(body.light) .journey-card {
    background-color: var(--color-light-surface);
    border-color: rgba(0,0,0,0.08); /* Visible border */
    box-shadow: 0 4px 12px rgba(0,0,0,0.03);
  }
  :global(body.light) .journey-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 8px 24px rgba(0,0,0,0.06);
  }
  
  :global(body.light) .journey-card.highlight {
    background-color: rgba(255, 61, 0, 0.05); /* Primary tint */
    border-color: rgba(255, 61, 0, 0.2);
  }

  :global(body.light) .journey-title {
    color: #1a1a1a;
  }
  :global(body.light) .journey-desc {
    color: #4a4a4a;
  }
  :global(body.light) .milestone-year {
    color: #4a4a4a;
  }

  /* Light mode primary text - darker for contrast */
  :global(body.light) #about .text-primary {
    color: #C62D00 !important;
  }

  /* Ensure buttons keep white text in light mode */
  :global(body.light) #about .bg-primary {
    color: white !important;
  }

  :global(body.light) #about a.bg-primary,
  :global(body.light) #about button.bg-primary {
    color: white !important;
  }

  /* Highlighted milestone year override */
  :global(body.light) .journey-card.highlight .text-primary {
    color: #C62D00 !important;
  }

  /* Custom Outline Button Light Mode Override */
  :global(body.light) .btn-outline-custom {
    color: #1F2937 !important;
    background-color: transparent !important;
    border-color: #374151 !important;
  }
  :global(body.light) .btn-outline-custom:hover {
    background-color: #E5E7EB !important;
    color: #000000 !important;
  }
</style>
