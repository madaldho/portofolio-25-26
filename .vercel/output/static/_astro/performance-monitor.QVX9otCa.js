class d{metrics={};observers=[];constructor(){typeof window<"u"&&this.initializeObservers()}initializeObservers(){if("PerformanceObserver"in window){try{const e=new PerformanceObserver(t=>{const n=t.getEntries(),r=n[n.length-1];this.metrics.lcp=r.startTime,this.reportMetric("LCP",r.startTime)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}catch(e){console.warn("LCP observer not supported:",e)}try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(r=>{this.metrics.fid=r.processingStart-r.startTime,this.reportMetric("FID",r.processingStart-r.startTime)})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}catch(e){console.warn("FID observer not supported:",e)}try{let e=0;const t=new PerformanceObserver(n=>{n.getEntries().forEach(s=>{s.hadRecentInput||(e+=s.value)}),this.metrics.cls=e,this.reportMetric("CLS",e)});t.observe({entryTypes:["layout-shift"]}),this.observers.push(t)}catch(e){console.warn("CLS observer not supported:",e)}try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(r=>{r.name==="first-contentful-paint"&&(this.metrics.fcp=r.startTime,this.reportMetric("FCP",r.startTime))})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}catch(e){console.warn("FCP observer not supported:",e)}}"performance"in window&&"getEntriesByType"in performance&&window.addEventListener("load",()=>{const e=performance.getEntriesByType("navigation");if(e.length>0){const t=e[0];this.metrics.ttfb=t.responseStart-t.requestStart,this.reportMetric("TTFB",t.responseStart-t.requestStart)}})}reportMetric(e,t){const n=window;typeof n.gtag<"u"&&n.gtag("event",e,{event_category:"Web Vitals",value:Math.round(t),non_interaction:!0}),this.sendToAnalytics(e,t)}async sendToAnalytics(e,t){const n=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");if(n)try{await fetch("/api/analytics/performance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({metric:e,value:Math.round(t),url:window.location.pathname,timestamp:Date.now(),userAgent:navigator.userAgent})})}catch(r){n&&console.warn("Failed to send performance metric:",r)}}getMetrics(){return{...this.metrics}}disconnect(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}static preloadResource(e,t="script"){if(typeof document<"u"){const n=document.createElement("link");n.rel="preload",n.href=e,n.as=t,document.head.appendChild(n)}}static prefetchResource(e){if(typeof document<"u"){const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)}}static measureFunction(e,t){if(typeof performance<"u"){const n=performance.now(),r=e(),s=performance.now();return console.log(`${t} took ${s-n} milliseconds`),r}return e()}static async measureAsyncFunction(e,t){if(typeof performance<"u"){const n=performance.now(),r=await e(),s=performance.now();return console.log(`${t} took ${s-n} milliseconds`),r}return await e()}}const l=new d;typeof window<"u"&&window.addEventListener("beforeunload",()=>{l.disconnect()});const c=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");function i(o){c&&fetch("/api/analytics/performance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a();function a(){p(),f(),u()}function p(){if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(n=>{n.duration>1e3&&(console.warn(`Slow resource: ${n.name} took ${Math.round(n.duration)}ms`),i({metric:"slow_resource",value:Math.round(n.duration),url:window.location.pathname,resource:n.name,timestamp:Date.now()}))})}).observe({entryTypes:["resource"]})}catch(o){console.warn("Resource observer not supported:",o)}}function f(){if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{e.getEntries().forEach(n=>{console.warn(`Long task detected: ${Math.round(n.duration)}ms`),i({metric:"long_task",value:Math.round(n.duration),url:window.location.pathname,timestamp:Date.now()})})}).observe({entryTypes:["longtask"]})}catch(o){console.warn("Long task observer not supported:",o)}}function u(){let o=Date.now(),e=!document.hidden;document.addEventListener("visibilitychange",()=>{const t=Date.now();if(document.hidden&&e){const n=t-o;i({metric:"page_engagement",value:n,url:window.location.pathname,timestamp:t}),e=!1}else!document.hidden&&!e&&(o=t,e=!0)}),window.addEventListener("beforeunload",()=>{if(e&&c){const t=Date.now()-o;"sendBeacon"in navigator&&navigator.sendBeacon("/api/analytics/performance",JSON.stringify({metric:"page_engagement",value:t,url:window.location.pathname,timestamp:Date.now()}))}})}export{l as performanceMonitor};
