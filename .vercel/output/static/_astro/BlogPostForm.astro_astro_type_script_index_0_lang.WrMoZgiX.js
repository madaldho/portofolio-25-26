import{C as E,c as b}from"./cmsManager.BXuPqiYF.js";import"./preload-helper.BlTxHScW.js";const o=document.getElementById("blog-post-modal"),p=document.getElementById("blog-post-form"),y=document.getElementById("close-blog-modal"),w=document.getElementById("cancel-blog-btn"),L=document.getElementById("save-draft-blog-btn");document.getElementById("publish-blog-btn");const a=document.getElementById("blog-title"),u=document.getElementById("blog-slug"),i=document.getElementById("blog-publish-date"),d=document.getElementById("blog-form-errors"),B=document.getElementById("blog-error-list"),c=document.getElementById("blog-form-success");let m=!1,f=null;a?.addEventListener("input",()=>{!m&&u&&(u.value=E.generateSlug(a.value))});if(i){const e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),i.value=e.toISOString().slice(0,16)}function S(e){if(o){if(o.classList.remove("hidden"),o.classList.add("flex"),document.body.style.overflow="hidden",e)m=!0,f=e.id,M(e),document.getElementById("blog-modal-title").textContent="Edit Blog Post";else if(m=!1,f=null,p?.reset(),document.getElementById("blog-modal-title").textContent="Create Blog Post",i){const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),i.value=t.toISOString().slice(0,16)}h(),a?.focus()}}function r(){o&&(o.classList.add("hidden"),o.classList.remove("flex"),document.body.style.overflow="",p?.reset(),h())}function M(e){a&&(a.value=e.fields.title["en-US"]||""),u&&(u.value=e.fields.slug["en-US"]||"");const t=document.getElementById("blog-excerpt");t&&(t.value=e.fields.excerpt["en-US"]||"");const g=document.getElementById("blog-content");g&&(g.value=e.fields.content["en-US"]||"");const l=document.getElementById("blog-tags");if(l&&e.fields.tags&&(l.value=e.fields.tags["en-US"].join(", ")),i&&e.fields.publishDate){const s=new Date(e.fields.publishDate["en-US"]);s.setMinutes(s.getMinutes()-s.getTimezoneOffset()),i.value=s.toISOString().slice(0,16)}}function v(e){d&&B&&(B.innerHTML=e.map(t=>`<li>â€¢ ${t}</li>`).join(""),d.classList.remove("hidden")),c&&c.classList.add("hidden")}function D(){c&&c.classList.remove("hidden"),d&&d.classList.add("hidden")}function h(){d&&d.classList.add("hidden"),c&&c.classList.add("hidden")}async function I(e){const t=new FormData(p),g=t.get("tags")?.split(",").map(n=>n.trim()).filter(Boolean)||[],l={title:t.get("title"),slug:t.get("slug"),excerpt:t.get("excerpt"),content:t.get("content"),tags:g,publishDate:t.get("publishDate"),status:e},s=E.validateBlogPost(l);if(s.length>0){v(s);return}try{let n;m&&f?n=await b.updateContent(f,l):n=await b.createBlogPost(l),n?(e==="published"&&await b.publishContent(n.id),D(),setTimeout(()=>{r(),window.dispatchEvent(new CustomEvent("refreshDashboard"))},1500)):v(["Failed to save blog post. Please try again."])}catch(n){console.error("Error saving blog post:",n),v(["An unexpected error occurred. Please try again."])}}y?.addEventListener("click",r);w?.addEventListener("click",r);L?.addEventListener("click",()=>I("draft"));p?.addEventListener("submit",e=>{e.preventDefault(),I("published")});o?.addEventListener("click",e=>{e.target===o&&r()});window.openBlogModal=S;window.closeBlogModal=r;
